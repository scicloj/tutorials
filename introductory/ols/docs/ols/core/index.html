<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script id="state" type="text">"{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 1903, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Wed Jul 21 00:16:21 IDT 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"220\" \"221\" \"222\" \"223\" \"224\" \"225\" \"226\" \"227\" \"228\" \"229\" \"230\" \"231\" \"232\" \"233\" \"234\" \"235\" \"236\" \"237\" \"238\" \"239\" \"240\" \"241\" \"242\" \"243\" \"244\" \"245\" \"246\" \"247\" \"248\" \"249\" \"250\" \"251\" \"252\" \"253\" \"254\" \"255\" \"256\" \"257\"], :id->content {\"253\" [:div [:p] [:div [:p/code {:code \"(.predict ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\") (double-array [1.0 0.05]))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.03440875994332247\\n\"}]], \"227\" [:div [:p] nil nil [:p/markdown \"We are explicitly parsing the dates.  We are also explicitly parsing vgu0 as it comes as `int` by default, which can mess up the returns later.\"]], \"234\" [:div [:p] nil nil [:p/markdown \"## smile OLS\"]], \"224\" [:div [:p] nil nil [:p/markdown \"Note we are using smile Java interop. There's a \\\"native\\\" Clojure implementation but more doc for the Java version, hence using that one.\\n\"]], \"237\" [:div [:p] nil nil [:p/markdown \"We also define a function to access the beta directly.\"]], \"238\" [:div [:p] [:div [:p/code {:code \"(defn ols-beta\\n  [dataset y x]\\n  (nth (.coefficients ^LinearModel (return-ols dataset y x)) 1))\", :bg-class \"bg-light\"}]] nil nil], \"231\" [:div [:p] [:div [:p/code {:code \"(defn stock-data-date-filter\\n  [yyyy-MM-dd]\\n  (ds/filter-column stock-data \\\"date\\\" #(.isAfter ^LocalDate % (LocalDate/parse yyyy-MM-dd))))\", :bg-class \"bg-light\"}]] nil nil], \"251\" [:div [:p] [:div [:p/code {:code \"(.RSquared ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\"))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.42050018964195\\n\"}]], \"232\" [:div [:p] nil nil [:p/markdown \"We need the stock market returns to perform our regression. We will calculate them column by column through a rolling window of 2 rows, excluding the date column. Note that by default tech.ml returns arrays of the same length as the input, which is generally a good thing. However in this case I will remove the first result, which tech.ml defaults to 0, while it should be undefined. This function is the rough equivalent of `df.pct_change()` in pandas.\"]], \"221\" [:div [:p] nil nil [:p/markdown \"# Basic OLS regression with tech.ml.dataset and smile\"]], \"249\" [:div [:p] [:div [:p/code {:code \"^kind/md ; rendering this as code inside markdown\\n[\\\"```\\\"\\n (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\")\\n \\\"```\\\"]\", :bg-class \"bg-light\"}]] nil [:p/markdown \"```\\n#object[smile.regression.LinearModel 0x26423aa3 Linear Model:\\n\\nResiduals:\\n       Min          1Q      Median          3Q         Max\\n   -0.0714     -0.0067      0.0001      0.0068      0.0970\\n\\nCoefficients:\\n                  Estimate Std. Error    t value   Pr(>|t|)\\nIntercept           0.0009     0.0014     0.6875     0.4928 \\nvgu0                0.6694     0.0615    10.8755     0.0000 ***\\n---------------------------------------------------------------------\\nSignificance codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\\n\\nResidual standard error: 0.0176 on 163 degrees of freedom\\nMultiple R-squared: 0.4205,    Adjusted R-squared: 0.4169\\nF-statistic: 118.2771 on 2 and 163 DF,  p-value: 4.662e-21\\n]\\n```\"]], \"226\" [:div [:p] nil nil [:p/markdown \"## Reading the file\"]], \"228\" [:div [:p] [:div [:p/code {:code \"(def stock-data\\n  ;TODO find a way to parse into float by default, except for some columns like date\\n  (ds/->dataset \\\"resources/clj-ols-data.csv\\\" {:parser-fn {\\\"date\\\" [:local-date \\\"yyyyMMdd\\\"]\\n                                                          \\\"vgu0\\\" :float32}}))\", :bg-class \"bg-light\"}]] nil nil], \"244\" [:div [:p] nil nil [:p/markdown \"Get the head of the dataset past 10Jun20.\"]], \"225\" [:div [:p] [:div [:p/code {:code \"(comment\\n  ;; we'll be calling some Java methods\\n  ;; commenting this out, since it fails as a notespace note\\n  ;; (Can't set!: *warn-on-reflection* from non-binding thread)\\n  (set! *warn-on-reflection* true))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"247\" [:div [:p] [:div [:p/code {:code \"(ds/head (ds-returns stock-data))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |        esu0 |        vgu0 |      random |\\n|------------|-------------|-------------|-------------|\\n| 2020-01-03 | -0.00733393 | -0.00755328 | -0.00603378 |\\n| 2020-01-06 |  0.00256640 | -0.00407719 |  0.00425292 |\\n| 2020-01-07 | -0.00255983 |  0.00300218 | -0.00886798 |\\n| 2020-01-08 |  0.00785473 |  0.00299320 |  0.01610518 |\\n| 2020-01-09 |  0.00486130 |  0.00569723 | -0.00363002 |\\n\\n\"}]], \"246\" [:div [:p] nil nil [:p/markdown \"Get the head of the dataset returns\"]], \"222\" [:div [:p] nil nil [:p/markdown \"The purpose of this notebook is to show basic data manipulation with tech.ml.dataset, and perform a linear regression between two vectors with the smile Java package. We will be comparing with Python / pandas where appropriate.\"]], \"250\" [:div [:p] nil nil [:p/markdown \"Get the R2 of a regression\"]], \"241\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(ds/head stock-data)\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"322px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-01-02 | 3238.375 | 3707.0 | 3459.6875 |\\n| 2020-01-03 | 3214.625 | 3679.0 | 3438.8125 |\\n| 2020-01-06 | 3222.875 | 3664.0 | 3453.4375 |\\n| 2020-01-07 | 3214.625 | 3675.0 | 3422.8125 |\\n| 2020-01-08 | 3239.875 | 3686.0 | 3477.9375 |\\n\"]]], \"257\" [:div [:p] nil nil [:p/markdown \"## End\"]], \"239\" [:div [:p] nil nil [:p/markdown \"## Examples\"]], \"240\" [:div [:p] nil nil [:p/markdown \"Get the head of a dataset\"]], \"223\" [:div [:p] nil nil [:p/markdown \"We will use equity index futures data: closing prices for S&P500 e-mini September 2020 contract, same for Eurostoxx 50, and a random combination of both. Our file also has a column of dates in yyyyMMdd format.\"]], \"229\" [:div [:p] nil nil [:p/markdown \"## Helpful functions\"]], \"235\" [:div [:p] nil nil [:p/markdown \"smile will return an OLS object that can be queried. The regression includes the intercept by default. Example queries:\\n* `(.coefficients ols)`\\n* `(.RSquared ols)`\\n* `(.predict ols (double-array [1. 0.05]))` *you need the intercept here, set at 1*\"]], \"254\" [:div [:p] nil nil [:p/markdown \"Get a couple of betas\"]], \"252\" [:div [:p] nil nil [:p/markdown \"Get a prediction - be careful that you need to include the intercept as 1.0 and that smile expects a Java double array\"]], \"256\" [:div [:p] [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"random\\\")\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.8758305642013672\\n\"}]], \"220\" [:div [:p] nil nil nil], \"233\" [:div [:p] [:div [:p/code {:code \"(defn ds-returns\\n  [dataset]\\n  (let [raw (reduce\\n              (fn [dts col] (assoc dts col (rolling/fixed-rolling-window (dts col) 2 (fn [[a b]] (dec (/ b a))))))\\n              dataset\\n              (remove #{\\\"date\\\"} (ds/column-names dataset)))]\\n    (ds/tail raw (dec (ds/row-count raw)))))\", :bg-class \"bg-light\"}]] nil nil], \"255\" [:div [:p] [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"vgu0\\\")\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.669367469325812\\n\"}]], \"236\" [:div [:p] [:div [:p/code {:code \"(defn return-ols\\n  [dataset y x]\\n  (OLS/fit\\n    (Formula/lhs ^String y)\\n    (-> dataset\\n        (ds/select-columns [y x])\\n        (ds-returns)\\n        (ds-smile/dataset->dataframe))))\", :bg-class \"bg-light\"}]] nil nil], \"245\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(ds/head (stock-data-date-filter \\\"2020-06-10\\\"))\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"322px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-06-11 | 2990.500 | 3125.0 | 3038.7500 |\\n| 2020-06-12 | 3014.875 | 3112.0 | 3050.4375 |\\n| 2020-06-15 | 3053.000 | 3108.0 | 3080.5000 |\\n| 2020-06-16 | 3109.375 | 3212.0 | 3170.6875 |\\n| 2020-06-17 | 3098.250 | 3236.0 | 3174.1250 |\\n\"]]], \"248\" [:div [:p] nil nil [:p/markdown \"Get the full smile output\"]], \"230\" [:div [:p] nil nil [:p/markdown \"First we define a date filter. The below will filter the data for dates *after* the input date. Think of it as pandas `df.loc[df.index>date]`.\"]], \"242\" [:div [:p] nil nil [:p/markdown \"Get the tail of a dataset\"]], \"243\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(ds/tail stock-data)\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"322px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-08-31 | 3488.500 | 3265.0 | 3360.7500 |\\n| 2020-09-01 | 3516.625 | 3271.0 | 3422.8125 |\\n| 2020-09-02 | 3568.750 | 3328.0 | 3471.3750 |\\n| 2020-09-03 | 3451.250 | 3293.0 | 3389.1250 |\\n| 2020-09-04 | 3406.500 | 3249.0 | 3310.7500 |\\n\"]]]}}"</script>
    <script src="gorilla-notes/js/compiled/main.js"></script>
</html>
