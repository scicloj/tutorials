<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script src="https://cdn.jsdelivr.net/gh/scicloj/gorilla-notes@master/dist/0.5.0-SNAPSHOT-5/main.js"></script>
    <script>
     shadow.loader.load("main");
     gorilla_notes.main.main_BANG_(false, "{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Fri Dec 18 00:31:34 IST 2020\"] nil nil [:hr]], :custom-footer [:div [:hr]]}, :ids [\"324\" \"325\" \"326\" \"327\" \"328\" \"329\" \"330\" \"331\" \"332\" \"333\" \"334\" \"335\" \"336\" \"337\" \"338\" \"339\" \"340\" \"341\" \"342\" \"343\" \"344\" \"345\" \"346\" \"347\" \"348\" \"349\" \"350\" \"351\" \"352\" \"353\" \"354\" \"355\" \"356\" \"357\" \"358\" \"359\" \"360\" \"361\"], :id->content {\"334\" [:div nil [:div [:p/markdown \"First we define a date filter. The below will filter the data for dates *after* the input date. Think of it as pandas `df.loc[df.index>date]`.\"]]], \"303\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"321\" [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"vgu0\\\")\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"359\" [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"vgu0\\\")\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"0.669367469325812\\n\"}]]], \"343\" [:div nil [:div [:p/markdown \"## Examples\"]]], \"305\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"300\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"290\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"315\" [:div [:p/code {:code \"^kind/md ; rendering this as code inside markdown\\n[\\\"```\\\"\\n (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\")\\n \\\"```\\\"]\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"304\" [:div [:p/code {:code \"(defn ols-beta\\n  [dataset y x]\\n  (nth (.coefficients ^LinearModel (return-ols dataset y x)) 1))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"295\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"346\" [:div nil [:div [:p/markdown \"Get the tail of a dataset\"]]], \"302\" [:div [:p/code {:code \"(defn return-ols\\n  [dataset y x]\\n  (OLS/fit\\n    (Formula/lhs ^String y)\\n    (-> dataset\\n        (ds/select-columns [y x])\\n        (ds-returns)\\n        (ds-smile/dataset->dataframe))))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"336\" [:div nil [:div [:p/markdown \"We need the stock market returns to perform our regression. We will calculate them column by column through a rolling window of 2 rows, excluding the date column. Note that by default tech.ml returns arrays of the same length as the input, which is generally a good thing. However in this case I will remove the first result, which tech.ml defaults to 0, while it should be undefined. This function is the rough equivalent of `df.pct_change()` in pandas.\"]]], \"355\" [:div [:p/code {:code \"(.RSquared ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\"))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"0.42050018964195\\n\"}]]], \"299\" [:div [:p/code {:code \"(defn ds-returns\\n  [dataset]\\n  (let [raw (reduce\\n              (fn [dts col] (assoc dts col (rolling/fixed-rolling-window (dts col) 2 (fn [[a b]] (dec (/ b a))))))\\n              dataset\\n              (remove #{\\\"date\\\"} (ds/column-names dataset)))]\\n    (ds/tail raw (dec (ds/row-count raw)))))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"329\" [:div [:p/code {:code \"(comment\\n  ;; we'll be calling some Java methods\\n  ;; commenting this out, since it fails as a notespace note\\n  ;; (Can't set!: *warn-on-reflection* from non-binding thread)\\n  (set! *warn-on-reflection* true))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"nil\\n\"}]]], \"328\" [:div nil [:div [:p/markdown \"Note we are using smile Java interop. There's a \\\"native\\\" Clojure implementation but more doc for the Java version, hence using that one.\\n\"]]], \"332\" [:div [:p/code {:code \"(def stock-data\\n  ;TODO find a way to parse into float by default, except for some columns like date\\n  (ds/->dataset \\\"resources/clj-ols-data.csv\\\" {:parser-fn {\\\"date\\\" [:local-date \\\"yyyyMMdd\\\"]\\n                                                          \\\"vgu0\\\" :float32}}))\", :bg-class \"bg-light\"}] [:div nil]], \"358\" [:div nil [:div [:p/markdown \"Get a couple of betas\"]]], \"345\" [:div [:p/code {:code \"^kind/dataset\\n(ds/head stock-data)\", :bg-class \"bg-light\"}] [:div [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-01-02 | 3238.375 | 3707.0 | 3459.6875 |\\n| 2020-01-03 | 3214.625 | 3679.0 | 3438.8125 |\\n| 2020-01-06 | 3222.875 | 3664.0 | 3453.4375 |\\n| 2020-01-07 | 3214.625 | 3675.0 | 3422.8125 |\\n| 2020-01-08 | 3239.875 | 3686.0 | 3477.9375 |\\n\"]]]], \"318\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"338\" [:div nil [:div [:p/markdown \"## smile OLS\"]]], \"354\" [:div nil [:div [:p/markdown \"Get the R2 of a regression\"]]], \"296\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"326\" [:div nil [:div [:p/markdown \"The purpose of this notebook is to show basic data manipulation with tech.ml.dataset, and perform a linear regression between two vectors with the smile Java package. We will be comparing with Python / pandas where appropriate.\"]]], \"297\" [:div [:p/code {:code \"(defn stock-data-date-filter\\n  [yyyy-MM-dd]\\n  (ds/filter-column stock-data \\\"date\\\" #(.isAfter ^LocalDate % (LocalDate/parse yyyy-MM-dd))))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"350\" [:div nil [:div [:p/markdown \"Get the head of the dataset returns\"]]], \"294\" [:div [:p/code {:code \"(def stock-data\\n  ;TODO find a way to parse into float by default, except for some columns like date\\n  (ds/->dataset \\\"resources/clj-ols-data.csv\\\" {:parser-fn {\\\"date\\\" [:local-date \\\"yyyyMMdd\\\"]\\n                                                          \\\"vgu0\\\" :float32}}))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"311\" [:div [:p/code {:code \"^kind/dataset\\n(ds/head (stock-data-date-filter \\\"2020-06-10\\\"))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"356\" [:div nil [:div [:p/markdown \"Get a prediction - be careful that you need to include the intercept as 1.0 and that smile expects a Java double array\"]]], \"341\" [:div nil [:div [:p/markdown \"We also define a function to access the beta directly.\"]]], \"357\" [:div [:p/code {:code \"(.predict ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\") (double-array [1.0 0.05]))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"0.03440875994332247\\n\"}]]], \"289\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"307\" [:div [:p/code {:code \"^kind/dataset\\n(ds/head stock-data)\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"312\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"337\" [:div [:p/code {:code \"(defn ds-returns\\n  [dataset]\\n  (let [raw (reduce\\n              (fn [dts col] (assoc dts col (rolling/fixed-rolling-window (dts col) 2 (fn [[a b]] (dec (/ b a))))))\\n              dataset\\n              (remove #{\\\"date\\\"} (ds/column-names dataset)))]\\n    (ds/tail raw (dec (ds/row-count raw)))))\", :bg-class \"bg-light\"}] [:div nil]], \"347\" [:div [:p/code {:code \"^kind/dataset\\n(ds/tail stock-data)\", :bg-class \"bg-light\"}] [:div [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-08-31 | 3488.500 | 3265.0 | 3360.7500 |\\n| 2020-09-01 | 3516.625 | 3271.0 | 3422.8125 |\\n| 2020-09-02 | 3568.750 | 3328.0 | 3471.3750 |\\n| 2020-09-03 | 3451.250 | 3293.0 | 3389.1250 |\\n| 2020-09-04 | 3406.500 | 3249.0 | 3310.7500 |\\n\"]]]], \"335\" [:div [:p/code {:code \"(defn stock-data-date-filter\\n  [yyyy-MM-dd]\\n  (ds/filter-column stock-data \\\"date\\\" #(.isAfter ^LocalDate % (LocalDate/parse yyyy-MM-dd))))\", :bg-class \"bg-light\"}] [:div nil]], \"331\" [:div nil [:div [:p/markdown \"We are explicitly parsing the dates.  We are also explicitly parsing vgu0 as it comes as `int` by default, which can mess up the returns later.\"]]], \"352\" [:div nil [:div [:p/markdown \"Get the full smile output\"]]], \"360\" [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"random\\\")\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"0.8758305642013672\\n\"}]]], \"293\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"308\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"313\" [:div [:p/code {:code \"(ds/head (ds-returns stock-data))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"320\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"325\" [:div nil [:div [:p/markdown \"# Basic OLS regression with tech.ml.dataset and smile\"]]], \"306\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"287\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"316\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"344\" [:div nil [:div [:p/markdown \"Get the head of a dataset\"]]], \"324\" [:div nil [:div nil]], \"353\" [:div [:p/code {:code \"^kind/md ; rendering this as code inside markdown\\n[\\\"```\\\"\\n (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\")\\n \\\"```\\\"]\", :bg-class \"bg-light\"}] [:div [:p/markdown \"```\\n#object[smile.regression.LinearModel 0x3dbfc044 Linear Model:\\n\\nResiduals:\\n       Min          1Q      Median          3Q         Max\\n   -0.0714     -0.0067      0.0001      0.0068      0.0970\\n\\nCoefficients:\\n                  Estimate Std. Error    t value   Pr(>|t|)\\nIntercept           0.0009     0.0014     0.6875     0.4928 \\nvgu0                0.6694     0.0615    10.8755     0.0000 ***\\n---------------------------------------------------------------------\\nSignificance codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\\n\\nResidual standard error: 0.0176 on 163 degrees of freedom\\nMultiple R-squared: 0.4205,    Adjusted R-squared: 0.4169\\nF-statistic: 118.2771 on 2 and 163 DF,  p-value: 4.662e-21\\n]\\n```\"]]], \"301\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"317\" [:div [:p/code {:code \"(.RSquared ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\"))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"340\" [:div [:p/code {:code \"(defn return-ols\\n  [dataset y x]\\n  (OLS/fit\\n    (Formula/lhs ^String y)\\n    (-> dataset\\n        (ds/select-columns [y x])\\n        (ds-returns)\\n        (ds-smile/dataset->dataframe))))\", :bg-class \"bg-light\"}] [:div nil]], \"286\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"342\" [:div [:p/code {:code \"(defn ols-beta\\n  [dataset y x]\\n  (nth (.coefficients ^LinearModel (return-ols dataset y x)) 1))\", :bg-class \"bg-light\"}] [:div nil]], \"319\" [:div [:p/code {:code \"(.predict ^LinearModel (return-ols stock-data \\\"esu0\\\" \\\"vgu0\\\") (double-array [1.0 0.05]))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"298\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"322\" [:div [:p/code {:code \"(ols-beta stock-data \\\"esu0\\\" \\\"random\\\")\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"348\" [:div nil [:div [:p/markdown \"Get the head of the dataset past 10Jun20.\"]]], \"339\" [:div nil [:div [:p/markdown \"smile will return an OLS object that can be queried. The regression includes the intercept by default. Example queries:\\n* `(.coefficients ols)`\\n* `(.RSquared ols)`\\n* `(.predict ols (double-array [1. 0.05]))` *you need the intercept here, set at 1*\"]]], \"288\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"310\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"327\" [:div nil [:div [:p/markdown \"We will use equity index futures data: closing prices for S&P500 e-mini September 2020 contract, same for Eurostoxx 50, and a random combination of both. Our file also has a column of dates in yyyyMMdd format.\"]]], \"333\" [:div nil [:div [:p/markdown \"## Helpful functions\"]]], \"291\" [:div [:p/code {:code \"(comment\\n  ;; we'll be calling some Java methods\\n  ;; commenting this out, since it fails as a notespace note\\n  ;; (Can't set!: *warn-on-reflection* from non-binding thread)\\n  (set! *warn-on-reflection* true))\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"330\" [:div nil [:div [:p/markdown \"## Reading the file\"]]], \"361\" [:div nil [:div [:p/markdown \"## End\"]]], \"349\" [:div [:p/code {:code \"^kind/dataset\\n(ds/head (stock-data-date-filter \\\"2020-06-10\\\"))\", :bg-class \"bg-light\"}] [:div [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |     esu0 |   vgu0 |    random |\\n|------------|----------|--------|-----------|\\n| 2020-06-11 | 2990.500 | 3125.0 | 3038.7500 |\\n| 2020-06-12 | 3014.875 | 3112.0 | 3050.4375 |\\n| 2020-06-15 | 3053.000 | 3108.0 | 3080.5000 |\\n| 2020-06-16 | 3109.375 | 3212.0 | 3170.6875 |\\n| 2020-06-17 | 3098.250 | 3236.0 | 3174.1250 |\\n\"]]]], \"323\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"351\" [:div [:p/code {:code \"(ds/head (ds-returns stock-data))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"resources/clj-ols-data.csv [5 4]:\\n\\n|       date |        esu0 |        vgu0 |      random |\\n|------------|-------------|-------------|-------------|\\n| 2020-01-03 | -0.00733393 | -0.00755328 | -0.00603378 |\\n| 2020-01-06 |  0.00256640 | -0.00407719 |  0.00425292 |\\n| 2020-01-07 | -0.00255983 |  0.00300218 | -0.00886798 |\\n| 2020-01-08 |  0.00785473 |  0.00299320 |  0.01610518 |\\n| 2020-01-09 |  0.00486130 |  0.00569723 | -0.00363002 |\\n\\n\"}]]], \"292\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"309\" [:div [:p/code {:code \"^kind/dataset\\n(ds/tail stock-data)\", :bg-class \"bg-light\"}] [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]], \"314\" [:div nil [:div [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(not evaluated yet)\"]]]]}}");
     document.getElementById("loading").remove();
    </script>
</html>
